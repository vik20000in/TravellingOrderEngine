<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <title>TravellingOrder Engine</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- ===== TOP NAV BAR ===== -->
  <nav id="navBar">
    <div class="nav-brand">TravellingOrder Engine</div>
    <div class="nav-links">
      <button class="nav-btn active" data-page="orders" onclick="switchPage('orders')">Orders</button>
      <button class="nav-btn" data-page="master" onclick="switchPage('master')">Master Data</button>
    </div>
  </nav>

  <!-- ===== PAGE: ORDERS ===== -->
  <div id="page-orders" class="page active">

    <!-- ===== STICKY HEADER ===== -->
    <header id="header">
      <div class="header-fields">
        <div class="field">
          <label for="customerName">Customer Name <span class="req">*</span></label>
          <input type="text" id="customerName" placeholder="Enter customer name" autocomplete="off" list="customerSuggestions" />
          <datalist id="customerSuggestions"></datalist>
        </div>
        <div class="field">
          <label for="orderDate">Order Date</label>
          <input type="date" id="orderDate" />
        </div>
        <div class="field">
          <label for="marketArea">Market / Area</label>
          <input type="text" id="marketArea" placeholder="Optional" autocomplete="off" />
        </div>
        <div class="field field-btn">
          <button id="btnSave" onclick="submitOrder()">
            <span id="btnText">Save Order</span>
            <span id="btnSpinner" class="spinner hidden"></span>
          </button>
        </div>
      </div>
      <!-- Summary bar -->
      <div id="summaryBar" class="summary-bar"></div>
    </header>

    <!-- ===== ORDER GRID (Excel-like) ===== -->
    <main id="orderGridContainer">
      <div class="loading-msg">Loading order form…</div>
    </main>

  </div>

  <!-- ===== PAGE: MASTER DATA ===== -->
  <div id="page-master" class="page">

    <div class="master-container">
      <!-- Sub-tabs for master data sections -->
      <div class="master-tabs">
        <button class="master-tab active" data-tab="variety" onclick="switchMasterTab('variety')">Varieties</button>
        <button class="master-tab" data-tab="items" onclick="switchMasterTab('items')">Items</button>
        <button class="master-tab" data-tab="customers" onclick="switchMasterTab('customers')">Customers</button>
      </div>

      <!-- Variety Tab Content -->
      <div id="masterTab-variety" class="master-tab-content active">

        <div class="master-header-row">
          <h2>Manage Varieties</h2>
          <button class="btn-add" onclick="openVarietyForm()">+ Add Variety</button>
        </div>

        <!-- Variety List -->
        <div id="varietyList" class="variety-list">
          <div class="loading-msg">Loading varieties…</div>
        </div>

        <!-- Variety Form (hidden by default) -->
        <div id="varietyFormPanel" class="variety-form-panel hidden">
          <h3 id="varietyFormTitle">Add New Variety</h3>
          <input type="hidden" id="varietyId" />

          <div class="form-group">
            <label for="varietyName">Variety Name <span class="req">*</span></label>
            <input type="text" id="varietyName" placeholder="e.g. Ganesh Lakshmi" autocomplete="off" />
          </div>

          <div class="form-group">
            <label for="varietyShortForm">Short Form</label>
            <input type="text" id="varietyShortForm" placeholder="e.g. GL" autocomplete="off" maxlength="10" />
          </div>

          <div class="form-group">
            <label for="varietyImageURL">Image URL</label>
            <input type="url" id="varietyImageURL" placeholder="https://example.com/image.jpg" autocomplete="off" />
          </div>

          <div class="form-group">
            <label for="varietySizes">Sizes <span class="hint">(comma-separated)</span></label>
            <input type="text" id="varietySizes" placeholder="e.g. 6 Inch, 9 Inch, 12 Inch" autocomplete="off" />
          </div>

          <!-- Image preview -->
          <div id="varietyImagePreview" class="image-preview hidden">
            <img id="varietyPreviewImg" src="" alt="Preview" />
          </div>

          <div class="form-actions">
            <button class="btn-cancel" onclick="closeVarietyForm()">Cancel</button>
            <button class="btn-confirm" onclick="saveVariety()">
              <span id="varietyBtnText">Save Variety</span>
              <span id="varietySpinner" class="spinner hidden"></span>
            </button>
          </div>
        </div>

      </div>

      <!-- Items Tab Content -->
      <div id="masterTab-items" class="master-tab-content">

        <div class="master-header-row">
          <h2>Manage Items</h2>
          <button class="btn-add" onclick="openItemForm()">+ Add Item</button>
        </div>

        <!-- Item List -->
        <div id="itemList" class="variety-list">
          <div class="loading-msg">Loading items…</div>
        </div>

        <!-- Item Form (hidden by default) -->
        <div id="itemFormPanel" class="variety-form-panel hidden">
          <h3 id="itemFormTitle">Add New Item</h3>
          <input type="hidden" id="itemId" />

          <div class="form-group">
            <label for="itemName">Item Name <span class="req">*</span></label>
            <input type="text" id="itemName" placeholder="e.g. Kurti" autocomplete="off" />
          </div>

          <div class="form-group">
            <label for="itemShortForm">Short Form</label>
            <input type="text" id="itemShortForm" placeholder="e.g. KRT" autocomplete="off" maxlength="10" />
          </div>

          <div class="form-group">
            <label>Colors</label>
            <div id="itemColorsContainer" class="colors-container">
              <div id="itemColorChips" class="color-chips">
                <span class="loading-msg">Loading colors…</span>
              </div>
              <div class="colors-input-row">
                <input type="text" id="itemColorInput" placeholder="Add custom color…" autocomplete="off" />
                <button type="button" class="btn-add-color" onclick="addCustomItemColor()">+</button>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label>Images <span class="hint">(optional, up to 3)</span></label>
            <div class="multi-upload-group">
              <div class="upload-row">
                <input type="file" id="itemImageFile1" accept="image/*" class="file-input" onchange="handleItemImageUpload(this, 1)" />
                <label for="itemImageFile1" class="btn-upload">Image 1</label>
                <span id="itemFileName1" class="file-name">No file chosen</span>
                <span id="itemUploadStatus1" class="upload-status"></span>
              </div>
              <input type="hidden" id="itemImage1" />

              <div class="upload-row">
                <input type="file" id="itemImageFile2" accept="image/*" class="file-input" onchange="handleItemImageUpload(this, 2)" />
                <label for="itemImageFile2" class="btn-upload">Image 2</label>
                <span id="itemFileName2" class="file-name">No file chosen</span>
                <span id="itemUploadStatus2" class="upload-status"></span>
              </div>
              <input type="hidden" id="itemImage2" />

              <div class="upload-row">
                <input type="file" id="itemImageFile3" accept="image/*" class="file-input" onchange="handleItemImageUpload(this, 3)" />
                <label for="itemImageFile3" class="btn-upload">Image 3</label>
                <span id="itemFileName3" class="file-name">No file chosen</span>
                <span id="itemUploadStatus3" class="upload-status"></span>
              </div>
              <input type="hidden" id="itemImage3" />
            </div>
            <div id="itemImagePreviews" class="item-image-previews"></div>
          </div>

          <!-- Sizes per variety -->
          <div class="form-group">
            <label>Sizes per Variety</label>
            <div id="itemSizesPerVariety" class="sizes-per-variety">
              <div class="loading-msg">Loading varieties…</div>
            </div>
          </div>

          <div class="form-group">
            <label for="itemPrice">Price</label>
            <input type="number" id="itemPrice" placeholder="e.g. 250" autocomplete="off" min="0" step="any" />
          </div>

          <div class="form-group">
            <label for="itemComment">Comment</label>
            <textarea id="itemComment" placeholder="Optional notes about this item…" rows="2"></textarea>
          </div>

          <div class="form-actions">
            <button class="btn-cancel" onclick="closeItemForm()">Cancel</button>
            <button class="btn-confirm" onclick="saveItem()">
              <span id="itemBtnText">Save Item</span>
              <span id="itemSpinner" class="spinner hidden"></span>
            </button>
          </div>
        </div>

      </div>

      <!-- Customers Tab Content -->
      <div id="masterTab-customers" class="master-tab-content">

        <div class="master-header-row">
          <h2>Manage Customers</h2>
          <button class="btn-add" onclick="openCustomerForm()">+ Add Customer</button>
        </div>

        <!-- Customer List -->
        <div id="customerList" class="variety-list">
          <div class="loading-msg">Loading customers…</div>
        </div>

        <!-- Customer Form (hidden by default) -->
        <div id="customerFormPanel" class="variety-form-panel hidden">
          <h3 id="customerFormTitle">Add New Customer</h3>
          <input type="hidden" id="custMasterId" />

          <div class="form-group">
            <label for="custMasterName">Customer Name <span class="req">*</span></label>
            <input type="text" id="custMasterName" placeholder="e.g. Sharma Textiles" autocomplete="off" />
          </div>

          <div class="form-group">
            <label for="custMasterPhone">Phone Number <span class="req">*</span></label>
            <input type="tel" id="custMasterPhone" placeholder="e.g. 9876543210" autocomplete="off" />
          </div>

          <div class="form-group">
            <label for="custMasterAddress">Address</label>
            <textarea id="custMasterAddress" placeholder="Optional address…" rows="2"></textarea>
          </div>

          <div class="form-group">
            <label>Images <span class="hint">(optional, up to 2)</span></label>
            <div class="multi-upload-group">
              <div class="upload-row">
                <input type="file" id="custImageFile1" accept="image/*" class="file-input" onchange="handleCustImageUpload(this, 1)" />
                <label for="custImageFile1" class="btn-upload">Image 1</label>
                <span id="custFileName1" class="file-name">No file chosen</span>
                <span id="custUploadStatus1" class="upload-status"></span>
              </div>
              <input type="hidden" id="custImage1" />

              <div class="upload-row">
                <input type="file" id="custImageFile2" accept="image/*" class="file-input" onchange="handleCustImageUpload(this, 2)" />
                <label for="custImageFile2" class="btn-upload">Image 2</label>
                <span id="custFileName2" class="file-name">No file chosen</span>
                <span id="custUploadStatus2" class="upload-status"></span>
              </div>
              <input type="hidden" id="custImage2" />
            </div>
            <div id="custImagePreviews" class="item-image-previews"></div>
          </div>

          <div class="form-actions">
            <button class="btn-cancel" onclick="closeCustomerForm()">Cancel</button>
            <button class="btn-confirm" onclick="saveCustomer()">
              <span id="customerBtnText">Save Customer</span>
              <span id="customerSpinner" class="spinner hidden"></span>
            </button>
          </div>
        </div>

      </div>

    </div>
  </div>

  <!-- ===== CONFIRMATION MODAL ===== -->
  <div id="modalOverlay" class="modal-overlay hidden">
    <div class="modal">
      <h2>Confirm Submission</h2>
      <p id="modalSummary"></p>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="closeModal()">Cancel</button>
        <button class="btn-confirm" onclick="confirmSubmit()">Yes, Submit</button>
      </div>
    </div>
  </div>

  <!-- ===== IMAGE LIGHTBOX ===== -->
  <div id="imageLightbox" class="lightbox-overlay hidden" onclick="closeLightbox()">
    <div class="lightbox-content" onclick="event.stopPropagation()">
      <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
      <img id="lightboxImg" src="" alt="Preview" />
    </div>
  </div>

  <!-- ===== TOAST ===== -->
  <div id="toast" class="toast hidden"></div>

  <script src="app.js"></script>
</body>
</html>
